<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Brawl Stars Tarzı Oyun</title>
<style>
html, body { margin:0; padding:0; overflow:hidden; font-family:sans-serif; background:#87CEEB; }
#gameCanvas { display:block; margin:0 auto; touch-action:none; background:#87CEEB; }

#joystick { position:absolute; bottom:20px; left:20px; width:100px; height:100px; background:rgba(0,0,0,0.3); border-radius:50%; }
#stick { position:absolute; width:50px; height:50px; background:rgba(0,0,0,0.6); border-radius:50%; top:25px; left:25px; touch-action:none; }

#fireControl { position:absolute; bottom:20px; right:20px; width:100px; height:100px; background:rgba(255,0,0,0.3); border-radius:50%; touch-action:none; }
#fireStick { position:absolute; width:50px; height:50px; background:rgba(255,0,0,0.6); border-radius:50%; top:25px; left:25px; }

#emoji { position:absolute; bottom:140px; right:50px; width:50px; height:50px; }
</style>
</head>
<body>
<canvas id="gameCanvas" width="800" height="1200"></canvas>
<div id="joystick"><div id="stick"></div></div>
<div id="fireControl"><div id="fireStick"></div></div>
<img src="emoji.png" id="emoji">
<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

const karakterImg = new Image();
karakterImg.src = 'karakter.png';

let karakter = {
  x: canvas.width/2-40, y: canvas.height-200, w:80, h:80,
  speed:5, bullets:[], can:6500, maxCan:6500,
  mermi:3, maxMermi:3, mermiReload:0.5, mermiTimer:0
};

let oyuncuAdi = "Oyuncu1";

// Joystick hareket
const joystick = document.getElementById('joystick');
const stick = document.getElementById('stick');
let joyActive=false, joyX=0, joyY=0;

stick.addEventListener('pointerdown', e=>{ joyActive=true; });
document.addEventListener('pointerup', e=>{ joyActive=false; joyX=0; joyY=0; stick.style.transform='translate(0px,0px)'; });
document.addEventListener('pointermove', e=>{
  if(joyActive){
    const rect = joystick.getBoundingClientRect();
    let dx = e.clientX-(rect.left+rect.width/2);
    let dy = e.clientY-(rect.top+rect.height/2);
    const dist = Math.min(Math.hypot(dx,dy),40);
    const angle = Math.atan2(dy,dx);
    joyX = Math.cos(angle)*dist/40;
    joyY = Math.sin(angle)*dist/40;
    stick.style.transform=`translate(${joyX*40}px,${joyY*40}px)`;
  }
});

// Fire joystick
const fireControl = document.getElementById('fireControl');
const fireStick = document.getElementById('fireStick');
let fireActive=false, fireX=0, fireY=0;

fireStick.addEventListener('pointerdown', e=>{ fireActive=true; });
document.addEventListener('pointerup', e=>{ fireActive=false; fireX=0; fireY=0; fireStick.style.transform='translate(0px,0px)'; });
document.addEventListener('pointermove', e=>{
  if(fireActive){
    const rect = fireControl.getBoundingClientRect();
    let dx = e.clientX-(rect.left+rect.width/2);
    let dy = e.clientY-(rect.top+rect.height/2);
    const dist = Math.min(Math.hypot(dx,dy),40);
    const angle = Math.atan2(dy,dx);
    fireX = Math.cos(angle)*dist/40;
    fireY = Math.sin(angle)*dist/40;
    fireStick.style.transform=`translate(${fireX*40}px,${fireY*40}px)`;
  }
});

// Güncelleme
function update(delta){
  karakter.x += joyX*karakter.speed;
  karakter.y += joyY*karakter.speed;

  karakter.x = Math.max(0, Math.min(canvas.width-karakter.w, karakter.x));
  karakter.y = Math.max(0, Math.min(canvas.height-karakter.h, karakter.y));

  // Mermi dolumu
  karakter.mermiTimer += delta/1000;
  if(karakter.mermiTimer>=karakter.mermiReload && karakter.mermi<karakter.maxMermi){
    karakter.mermi++;
    karakter.mermiTimer=0;
  }

  // Ateş et
  if(fireActive && karakter.mermi>0){
    const bulletSpeed = 15;
    karakter.bullets.push({
      x:karakter.x+karakter.w/2,
      y:karakter.y+karakter.h/2,
      dx:fireX*bulletSpeed,
      dy:fireY*bulletSpeed
    });
    karakter.mermi--;
    fireActive=false; // her dokunuşta 1 mermi
  }

  // Mermiler hareket
  karakter.bullets.forEach((b,i)=>{
    b.x += b.dx;
    b.y += b.dy;
    if(b.x<0||b.x>canvas.width||b.y<0||b.y>canvas.height) karakter.bullets.splice(i,1);
  });
}

// Çizim
function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // Harita alt taban kahverengi
  ctx.fillStyle='#8B4513';
  ctx.fillRect(0, canvas.height-150, canvas.width, 150);

  // Yan dağ duvarları
  ctx.fillStyle='#A0522D';
  ctx.beginPath();
  ctx.moveTo(0,canvas.height);
  ctx.lineTo(50,canvas.height-150);
  ctx.lineTo(0,canvas.height-150);
  ctx.closePath(); ctx.fill();

  ctx.beginPath();
  ctx.moveTo(canvas.width,canvas.height);
  ctx.lineTo(canvas.width-50,canvas.height-150);
  ctx.lineTo(canvas.width,canvas.height-150);
  ctx.closePath(); ctx.fill();

  // Karakter
  ctx.drawImage(karakterImg, karakter.x, karakter.y, karakter.w, karakter.h);

  // Oyuncu adı
  ctx.fillStyle='white';
  ctx.font='20px Arial';
  ctx.textAlign='center';
  ctx.fillText(oyuncuAdi, karakter.x+karakter.w/2, karakter.y-20);

  // Can ve mermi bar
  const barWidth = 80;
  // Can
  ctx.fillStyle='red';
  ctx.fillRect(karakter.x, karakter.y-15, barWidth, 8);
  ctx.fillStyle='green';
  ctx.fillRect(karakter.x, karakter.y-15, barWidth*(karakter.can/karakter.maxCan), 8);
  // Mermi
  ctx.fillStyle='grey';
  ctx.fillRect(karakter.x, karakter.y-5, barWidth, 5);
  ctx.fillStyle='yellow';
  ctx.fillRect(karakter.x, karakter.y-5, barWidth*(karakter.mermi/karakter.maxMermi),5);

  // Mermiler
  ctx.strokeStyle='white';
  ctx.lineWidth=3;
  karakter.bullets.forEach(b=>{
    ctx.beginPath();
    ctx.moveTo(b.x, b.y);
    ctx.lineTo(b.x-b.dx*2, b.y-b.dy*2);
    ctx.stroke();
  });
}

// Döngü
let lastTime=0;
function gameLoop(timestamp){
  const delta = timestamp-lastTime;
  lastTime=timestamp;
  update(delta);
  draw();
  requestAnimationFrame(gameLoop);
}
gameLoop();
</script>
</body>
</html>
